!function(a,b){"function"==typeof define&&define.amd?define(["underscore","jquery"],function(c,d){var e=b(a,c,d);return e}):a.Picker=b(a,a._,a.jQuery||a.Zepto||a.$)}(this,function(a,b,c){var d=function(a,d,e){function f(){e.allowDuplicates||c("#"+d).remove();var a,b,f,g={},a=c("<div id='"+d+"'></div>").appendTo(e.container);if(e.modal===!0){a.addClass(l.picker_modal_class);var b=c("<div class='"+l.picker_class+"'></div>").appendTo(a),f=c("<div class='"+l.picker_overlay_class+"'></div>").appendTo(a);a.css({position:"fixed","z-index":l.zindex,top:"0px",left:"0px",bottom:"0px",right:"0px",height:"100%",width:"100%","overflow-y":"auto","overflow-x":"hidden"}),f.css({position:"fixed","z-index":l.zindex+1,top:"0px",left:"0px",bottom:"0px",right:"0px",height:"100%",width:"100%"}),b.css({position:"absolute","z-index":l.zindex+2}),g.element=a,g.overlay=f,g.picker=b}else a.addClass(l.picker_class),a.addClass(l.picker_static_class),a.css({position:"absolute","z-index":l.zindex+2}),g.element=g.picker=a;e.draggable&&g.element.addClass(l.picker_draggable_class);for(var h=["width","height","top","left","bottom","right"],i=h.length-1;i>=0;i--){var j=h[i];"undefined"!==c.type(e[j])&&"null"!==c.type(e[j])&&"auto"!==e[j]&&g.picker.css(j,e[j])}if("array"===c.type(e.extraClass))for(var i=e.extraClass.length-1;i>=0;i--){var k=e.extraClass[i];g.picker.addClass(k)}else"string"===c.type(e.extraClass)&&g.picker.addClass(e.extraClass);if(e.transition&&(g.picker.addClass(e.transition),g.element.addClass(e.transition)),e.closeButton){var m=c("<div class='"+l.close_button_class+"' "+l.picker_close_attr+">&times;</div>").appendTo(g.picker);g.close_button=m}var n=c("<div class='"+l.content_class+"'></div>").appendTo(g.picker);if(g.content=n,e.confirmButton===!0||"string"===c.type(e.confirmButton)){var o="string"===c.type(e.confirmButton)?e.confirmButton:"OK",p=c("<div class='"+l.picker_footer_class+"'><button class='btn btn-default "+l.ok_button_class+"' "+l.picker_ok_attr+">"+o+"</button></div>").appendTo(g.picker);g.confirm_button=p}return g}function g(){var a=k.elements;void 0!==a&&("undefined"!==c.type(a.overlay)&&e.clickOverlay&&a.overlay.click(function(){k.hide()}),c(a.picker).find("["+l.picker_close_attr+"]").click(function(){k.hide()}),c(a.picker).find("["+l.picker_ok_attr+"]").click(function(){var a=i();n.trigger("onSet",a),k.hide()}),e.draggable===!0&&a.picker.draggable({zindex:l.zindex+2}))}function h(){}function i(){var a={};return k.elements.content.find("select, input, textarea, ["+l.selectable_attr+"]").each(function(){var b,d=c(this).attr(l.selectable_attr);b="undefined"!==c.type(d)&&d!==!1?d:c(this).val();var e=c(this).attr("name")||c(this).attr("id")||c(this).prop("tagName");a[e]=b}),a}function j(a){console.log("Picker: "+a)}var k=this;k.type=a,k.id=d,k.options=e;var l={picker_class:"picker-picker",picker_modal_class:"picker-modal",picker_overlay_class:"picker-overlay",picker_draggable_class:"picker-draggable",picker_static_class:"picker-static",picker_footer_class:"picker-footer",close_button_class:"picker-close-button",ok_button_class:"picker-ok-button",content_class:"picker-content",possible_types:["regular","regularList","geo"],default_type:"regular",possible_transitions:["no-transition","fade","slide","slideUp","slideRight","slideLeft"],default_transition:"slide",picker_close_attr:"data-picker-close",picker_ok_attr:"data-picker-ok",selectable_attr:"data-picker-selectable",value_attr:"data-picker-value",zindex:9e3},m={top:"50px",left:"auto",bottom:"auto",right:"auto",width:"260px",height:"auto",extraClass:[],transition:l.default_transition,container:"body",closeButton:!1,confirmButton:!1,clickOverlay:!0,modal:!0,draggable:!1,"static":!1,allowDuplicates:!1,removeHTML:!1,beforeShow:void 0,afterShow:void 0,beforeHide:void 0,afterHide:void 0,onInteraction:void 0,onSet:void 0,contentData:void 0,contentTemplate:void 0,contentScript:void 0};e=k.options=c.extend(m,k.options),-1===l.possible_types.indexOf(k.type)&&(j("Type not supported. Switching to '"+l.default_type+"'"),k.type=l.default_type),-1===l.possible_transitions.indexOf(k.options.transition)&&(j("Transition not supported. Switching to '"+l.default_transition+"'"),k.options.transition=l.default_transition),c(e.container).length<1&&(j("Selected container '"+k.options.container+"' does not exist. Switching to 'body'"),k.options.container="body"),e=k.options=c.extend(m,k.options),a=k.type;var n=k.events={events:{},bind:function(a,b){"array"!==c.type(this.events[a])&&(this.events[a]=[]),c.isFunction(b)?this.events[a].push(b):j("Can't bind '"+b+"' to event '"+a+"'. It must be a function!")},trigger:function(a,b){if("undefined"!==c.type(this.events[a]))for(var d=0,e=this.events[a].length;e>d;d++){var f=this.events[a][d];c.isFunction(f)?"undefined"===c.type(b)?f():f(b):j("Can't execute '"+func+"' on event '"+a+"'. It must be a function!")}}},o={parse:function(a,d){var e=b.template(a,d);return"function"===c.type(e)?e():e},build:function(a,d,e,f){d=d||{};var g,h;switch(a){case"geo":d=b.extend({title:"Pick your country",options:[{value:"sv",name:"Sverige"},{value:"br",name:"Brazil"},{value:"us",name:"United States"}]},d),g=this.templates.select_one,h=this.functions.select_one;break;case"text":d=b.extend({title:"Pick your country",options:[{value:"sv",name:"Sverige"},{value:"br",name:"Brazil"},{value:"us",name:"United States"}]},d),g=this.templates.select_one,h=this.functions.select_one;break;case"regularList":d=b.extend({text:"Pick one",options:[{value:"",name:"Choose...",selected:!0},{value:"1",name:"One"},{value:"2",name:"Two"},{value:"3",name:"Three"}]},d),g=this.templates.one_from_list,h=this.functions.one_from_list;break;case"regular":default:d=b.extend({text:"Pick one",options:[{value:"",name:"Choose...",selected:!0},{value:"1",name:"One"},{value:"2",name:"Two"},{value:"3",name:"Three"}]},d),g=this.templates.select_one,h=this.functions.select_one}return"string"!==c.type(e)&&(e=g),"function"!==c.type(f)&&(f=h),{markup:this.parse(e,d),postRender:f}},templates:{html:"<div><%= text %></div>",select_one:"<h4><%= text %></h4><div><select class='form-control' id='picker_selector'><% _.each(options, function(opt) { %><option value='<%= opt.value %>' <%= (opt.selected) ? 'selected' : '' %>><%= opt.name %></option><% }); %></select></div>",one_from_list:"<h4 align='center'><%= text %></h4><div><div id='picker_selector' class='btn-group-vertical' "+l.selectable_attr+"><% _.each(options, function(opt) { %><button "+l.value_attr+"='<%= opt.value %>' class='btn btn-default btn-block <%= (opt.selected) ? 'active' : '' %>'><%= opt.name %></button><% }); %></div></div>"},functions:{select_one:function(a){a.find("#picker_selector").on("change",function(){var b=a.find("#picker_selector").val();n.trigger("onInteraction",b)})},one_from_list:function(a){var b=a.find("#picker_selector"),d=b.find("button");d.each(function(){var a=c(this);a.on("click",function(){d.removeClass("active"),a.addClass("active");var c=a.attr(l.value_attr);b.attr(l.selectable_attr,c),n.trigger("onInteraction",c)})})}}};k.content=o.build(a,e.contentData,e.contentTemplate,e.contentScript),k.show=function(){if(n.trigger("beforeShow"),b.isUndefined(k.elements)){k.elements=f(),g();var a=k.elements.content;a.html(k.content.markup),"function"===c.type(k.content.postRender)&&k.content.postRender(a)}if(k.elements.element.css("display","block"),k.elements.picker.css({top:e.top,right:e.right,bottom:e.bottom,left:e.left}),e.modal===!0){{var d=k.elements.picker.outerWidth();k.elements.picker.outerWidth()}"auto"===e.left&"auto"===e.right&&k.elements.picker.css({left:"50%","margin-left":-(d/2)+"px"})}k.elements.element.addClass("visible"),n.trigger("afterShow")},k.hide=function(){if(!b.isUndefined(k.elements)){n.trigger("beforeHide"),k.elements.element.removeClass("visible");var a="no-transition"===e.transition?0:500,c=setInterval(function(){k.elements.element.css("display","none"),h(),n.trigger("afterHide"),clearInterval(c)},a)}},k.clear=function(){b.each(k.elements,function(a){a.remove()}),k.remove()};for(var p=["beforeShow","afterShow","beforeHide","afterHide","onInteraction","onSet"],q=p.length-1;q>=0;q--){var r=p[q];"function"===c.type(e[r])&&n.bind(r,e[r])}return k};return c.fn.draggable=function(a){if(a=c.extend({handle:"",zindex:9999},a),""===a.handle)var b=this;else var b=this.find(a.handle);return b.on("mousedown",function(b){if(""===a.handle)var d=c(this).addClass("draggable");else var d=c(this).addClass("active-handle").parent().addClass("draggable");var e=d.css("z-index"),f=d.outerHeight(),g=d.outerWidth(),h=d.offset().top+f-b.pageY,i=d.offset().left+g-b.pageX;d.css("z-index",a.zindex).parents().on("mousemove",function(a){c(".draggable").offset({top:a.pageY+h-f,left:a.pageX+i-g}).on("mouseup",function(){c(this).removeClass("draggable").css("z-index",e)})}),b.preventDefault()}).on("mouseup",function(){""===a.handle?c(this).removeClass("draggable"):c(this).removeClass("active-handle").parent().removeClass("draggable")})},d});