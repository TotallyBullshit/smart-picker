!function(a){a.extend({picker:function(b,c,d){function e(a){console.log("Picker: "+a)}function f(){d.allowDuplicates||a("#"+c).remove();var b,e,f,g={},b=a("<div id='"+c+"'></div>").appendTo(d.container);if(d.modal===!0){b.addClass(m.picker_modal_class);var e=a("<div class='"+m.picker_class+"'></div>").appendTo(b),f=a("<div class='"+m.picker_overlay_class+"'></div>").appendTo(b);b.css({position:"fixed","z-index":m.zindex,top:"0px",left:"0px",bottom:"0px",right:"0px",height:"100%",width:"100%","overflow-y":"auto","overflow-x":"hidden"}),f.css({position:"fixed","z-index":m.zindex+1,top:"0px",left:"0px",bottom:"0px",right:"0px",height:"100%",width:"100%"}),e.css({position:"absolute","z-index":m.zindex+2}),g.element=b,g.overlay=f,g.picker=e}else b.addClass(m.picker_class),b.addClass(m.picker_static_class),b.css({position:"absolute","z-index":m.zindex+2}),g.element=g.picker=b;d.draggable&&g.element.addClass(m.picker_draggable_class);for(var h=["width","height","top","left","bottom","right"],i=h.length-1;i>=0;i--){var j=h[i];"undefined"!==a.type(d[j])&&"null"!==a.type(d[j])&&"auto"!==d[j]&&g.picker.css(j,d[j])}if("array"===a.type(d.extraClass))for(var i=d.extraClass.length-1;i>=0;i--){var k=d.extraClass[i];g.picker.addClass(k)}else"string"===a.type(d.extraClass)&&g.picker.addClass(d.extraClass);if(d.transition&&(g.picker.addClass(d.transition),g.element.addClass(d.transition)),d.closeButton){var l=a("<div class='"+m.close_button_class+"' "+m.picker_close_attr+">&times;</div>").appendTo(g.picker);g.close_button=l}var n=a("<div class='"+m.content_class+"'></div>").appendTo(g.picker);if(g.content=n,d.confirmButton===!0||"string"===a.type(d.confirmButton)){var o="string"===a.type(d.confirmButton)?d.confirmButton:"OK",p=a("<div class='"+m.picker_footer_class+"'><button class='btn btn-default "+m.ok_button_class+"' "+m.picker_ok_attr+">"+o+"</button></div>").appendTo(g.picker);g.confirm_button=p}return g}function g(){if(o.trigger("beforeOpen"),s.picker.css({top:d.top,right:d.right,bottom:d.bottom,left:d.left}),d.modal===!0){{var a=s.picker.outerWidth();s.picker.outerWidth()}"auto"===d.left&"auto"===d.right&&s.picker.css({left:"50%","margin-left":-(a/2)+"px"})}s.element.addClass("visible"),o.trigger("afterOpen")}function h(){o.trigger("beforeClose"),s.element.removeClass("visible");var a="no-transition"===d.transition?0:500,b=setInterval(function(){o.trigger("afterClose"),clearInterval(b)},a)}function i(){for(q in s)s[q].remove()}function j(){"undefined"!==a.type(s.overlay)&&d.clickOverlay&&s.overlay.click(function(){h()}),a(s.picker).find("["+m.picker_close_attr+"]").click(function(){h()}),a(s.picker).find("["+m.picker_ok_attr+"]").click(function(){var a=l();o.trigger("onSet",a),h()}),d.draggable===!0&&s.picker.draggable({zindex:m.zindex+2})}function k(){}function l(){var b={};return s.content.find("select, input, textarea, ["+m.selectable_attr+"]").each(function(){var c,d=a(this).attr(m.selectable_attr);c="undefined"!==a.type(d)&&d!==!1?d:a(this).val();var e=a(this).attr("name")||a(this).attr("id")||a(this).prop("tagName");b[e]=c}),b}var m={picker_class:"picker-picker",picker_modal_class:"picker-modal",picker_overlay_class:"picker-overlay",picker_draggable_class:"picker-draggable",picker_static_class:"picker-static",picker_footer_class:"picker-footer",close_button_class:"picker-close-button",ok_button_class:"picker-ok-button",content_class:"picker-content",possible_types:["regular","regularList","geo"],default_type:"regular",possible_transitions:["no-transition","fade","slide","slideUp","slideRight","slideLeft"],default_transition:"slide",picker_close_attr:"data-picker-close",picker_ok_attr:"data-picker-ok",selectable_attr:"data-picker-selectable",value_attr:"data-picker-value",zindex:9e3},n={top:"50px",left:"auto",bottom:"auto",right:"auto",width:"auto",height:"auto",extraClass:[],transition:m.default_transition,container:"body",closeButton:!1,confirmButton:!1,clickOverlay:!0,modal:!0,draggable:!1,"static":!1,allowDuplicates:!1,beforeOpen:void 0,afterOpen:void 0,beforeClose:void 0,afterClose:void 0,onInteraction:void 0,onSet:void 0,contentData:void 0,contentTemplate:void 0,contentScript:void 0};d=a.extend(n,d);for(var o={events:{},bind:function(b,c){"array"!==a.type(this.events[b])&&(this.events[b]=[]),a.isFunction(c)?this.events[b].push(c):e("Can't bind '"+c+"' to event '"+b+"'. It must be a function!")},trigger:function(b,c){if("undefined"!==a.type(this.events[b]))for(var d=0,f=this.events[b].length;f>d;d++){var g=this.events[b][d];a.isFunction(g)?"undefined"===a.type(c)?g():g(c):e("Can't execute '"+func+"' on event '"+b+"'. It must be a function!")}}},p=["beforeOpen","afterOpen","beforeClose","afterClose","onInteraction","onSet"],q=p.length-1;q>=0;q--){var r=p[q];"function"===a.type(d[r])&&o.bind(r,d[r])}o.bind("beforeOpen",j),o.bind("afterClose",k),o.bind("afterClose",i),-1===m.possible_types.indexOf(b)&&(e("Type not supported. Switching to '"+m.default_type+"'"),b=m.default_type),-1===m.possible_transitions.indexOf(d.transition)&&(e("Transition not supported. Switching to '"+m.default_transition+"'"),d.transition=m.default_transition),a(d.container).length<1&&(e("Selected container '"+d.container+"' does not exist. Switching to 'body'"),d.container="body");var s=f(),t={parse:function(b,c){var d=_.template(b,c);return"function"===a.type(d)?d():d},build:function(b,c,d,e){c=c||{};var f,g;switch(b){case"geo":c=_.extend({title:"Pick your country",options:[{value:"sv",name:"Sverige"},{value:"br",name:"Brazil"},{value:"us",name:"United States"}]},c),f=this.templates.select_one,g=this.functions.select_one;break;case"regularList":c=_.extend({title:"Pick one",options:[{value:"",name:"Choose...",selected:!0},{value:"1",name:"One"},{value:"2",name:"Two"},{value:"3",name:"Three"}]},c),f=this.templates.one_from_list,g=this.functions.one_from_list;break;case"regular":default:c=_.extend({title:"Pick one",options:[{value:"",name:"Choose...",selected:!0},{value:"1",name:"One"},{value:"2",name:"Two"},{value:"3",name:"Three"}]},c),f=this.templates.select_one,g=this.functions.select_one}return"string"!==a.type(d)&&(d=f),"function"!==a.type(e)&&(e=g),{markup:this.parse(d,c),postRender:e}},templates:{select_one:"<h4><%= title %></h4><div><select class='form-control' id='picker_selector'><% _.each(options, function(opt) { %><option value='<%= opt.value %>' <%= (opt.selected) ? 'selected' : '' %>><%= opt.name %></option><% }); %></select></div>",one_from_list:"<h4 align='center'><%= title %></h4><div><div id='picker_selector' class='btn-group-vertical' "+m.selectable_attr+"><% _.each(options, function(opt) { %><button "+m.value_attr+"='<%= opt.value %>' class='btn btn-default btn-block <%= (opt.selected) ? 'active' : '' %>'><%= opt.name %></button><% }); %></div></div>"},functions:{select_one:function(a){a.find("#picker_selector").on("change",function(){var b=a.find("#picker_selector").val();o.trigger("onInteraction",b)})},one_from_list:function(b){var c=b.find("#picker_selector"),d=c.find("button");d.each(function(){var b=a(this);b.on("click",function(){d.removeClass("active"),b.addClass("active");var a=b.attr(m.value_attr);c.attr(m.selectable_attr,a),o.trigger("onInteraction",a)})})}}},u=t.build(b,d.contentData,d.contentTemplate,d.contentScript);s.content.html(u.markup),"function"===a.type(u.postRender)&&u.postRender(s.content),g()}}),a.fn.draggable=function(b){if(b=a.extend({handle:"",zindex:9999},b),""===b.handle)var c=this;else var c=this.find(b.handle);return c.on("mousedown",function(c){if(""===b.handle)var d=a(this).addClass("draggable");else var d=a(this).addClass("active-handle").parent().addClass("draggable");var e=d.css("z-index"),f=d.outerHeight(),g=d.outerWidth(),h=d.offset().top+f-c.pageY,i=d.offset().left+g-c.pageX;d.css("z-index",b.zindex).parents().on("mousemove",function(b){a(".draggable").offset({top:b.pageY+h-f,left:b.pageX+i-g}).on("mouseup",function(){a(this).removeClass("draggable").css("z-index",e)})}),c.preventDefault()}).on("mouseup",function(){""===b.handle?a(this).removeClass("draggable"):a(this).removeClass("active-handle").parent().removeClass("draggable")})}}(jQuery);